<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Boost your mood with MoodTask! Select your mood and get quick, science-backed tasks to feel better in seconds.">
    <meta name="keywords" content="moodtask, mood boost, mental health, quick tasks">
    <meta name="robots" content="index, follow">
    <title>MoodTask | Boost Your Mood in Seconds</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1511837633001567" crossorigin="anonymous" data-ad-init-load="300"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4985X51W1J"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-4985X51W1J');
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <nav id="nav">
        <div class="logo">Mood<span>Task</span></div>
        <div class="nav-links">
            <a href="index.html" class="nav-button active">Home</a>
            <a href="about.html" class="nav-button">About</a>
        </div>
    </nav>

    <div class="hero-section">
        <h1>Boost Your Mood in Seconds</h1>
        <h2>Select Your Mood and Get a Quick, Science-Backed Task</h2>
        <button class="hero-cta" onclick="scrollToMoodPrompt()">Get Started</button>
    </div>

    <div id="intro-content">
        <h2 class="section-heading">Why MoodTask?</h2>
        <div class="feature-cards">
            <div class="feature-card">
                <span class="feature-icon">‚ö°</span>
                <h3>Quick Tasks</h3>
                <p>Most tasks take less than a minute, perfect for busy days.</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">üß†</span>
                <h3>Science-Backed</h3>
                <p>Tasks are rooted in psychology and neuroscience research.</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">üéØ</span>
                <h3>Personalized</h3>
                <p>Get activities tailored to your current mood.</p>
            </div>
        </div>
    </div>

    <div id="mood-prompt">
        <h2 id="instruction">How Are You Feeling Right Now?</h2>
        <div id="mood-buttons">
            <button data-mood="tired" data-tooltip="Feeling low-energy or sleepy?"><span class="mood-icon">üò¥</span> Tired</button>
            <button data-mood="stressed" data-tooltip="Feeling overwhelmed or tense?"><span class="mood-icon">üò∞</span> Stressed</button>
            <button data-mood="sad" data-tooltip="Feeling down or emotional?"><span class="mood-icon">üò¢</span> Sad</button>
            <button data-mood="anxious" data-tooltip="Feeling nervous or worried?"><span class="mood-icon">üòü</span> Anxious</button>
            <button data-mood="angry" data-tooltip="Feeling frustrated or upset?"><span class="mood-icon">üò†</span> Angry</button>
            <button data-mood="bored" data-tooltip="Feeling restless or uninspired?"><span class="mood-icon">üòê</span> Bored</button>
            <button data-mood="happy" data-tooltip="Feeling cheerful or content?"><span class="mood-icon">üòä</span> Happy</button>
            <button data-mood="lonely" data-tooltip="Feeling isolated or disconnected?"><span class="mood-icon">üòî</span> Lonely</button>
        </div>
    </div>

    <div id="result"></div>

    <div class="tools-container">
        <button class="tool-button breathing" onclick="openPopup('breathing')"><i class="fas fa-wind tool-icon"></i> Breathing Exercise</button>
        <button class="tool-button gratitude" onclick="openPopup('gratitude')"><i class="fas fa-heart tool-icon"></i> Gratitude Note</button>
        <button class="tool-button soundscape" onclick="openPopup('soundscape')"><i class="fas fa-headphones tool-icon"></i> Soundscape</button>
        <button class="tool-button punching" onclick="openPopup('punching')"><i class="fas fa-fist-raised tool-icon"></i> Punching Bag</button>
        <button class="tool-button stretch" onclick="openPopup('stretch')"><i class="fas fa-child tool-icon"></i> Quick Stretch</button>
        <button class="tool-button doodle" onclick="openPopup('doodle')"><i class="fas fa-paint-brush tool-icon"></i> Doodle Pad</button>
        <button class="tool-button dance" onclick="openPopup('dance')"><i class="fas fa-music tool-icon"></i> Dance Break</button>
        <button class="tool-button worry" onclick="openPopup('worry')"><i class="fas fa-trash tool-icon"></i> Worry Shredder</button>
        <button class="tool-button color" onclick="openPopup('color')"><i class="fas fa-palette tool-icon"></i> Color Shift</button>
    </div>

    <div id="banner">
        <p class="disclaimer"><em>Affiliate Disclosure: MoodTask may earn a commission if you click the link below and make a purchase, at no additional cost to you.</em></p>
        <p class="ad-label">Sponsored: Support Your Mental Health</p>
        <a href="https://onlinetherapy.go2cloud.org/SHjO?file_id=78" class="banner-link">
            <img src="https://media.go2speed.org/brand/files/onlinetherapy/2/online-therapy-com-logo-728x90.png" alt="Online Therapy Banner" class="banner-img">
        </a>
        <img src="https://onlinetherapy.go2cloud.org/aff_i?offer_id=2&file_id=78&aff_id=4837" width="0" height="0" style="position:absolute;visibility:hidden;" border="0" />
    </div>

    <button id="share" aria-label="Share this page on X">
        <svg class="share-logo" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
        </svg>
        <span>Share on X</span>
    </button>

    <div id="donate">
        <h3>Support MoodTask</h3>
        <p>If you find MoodTask helpful, please consider supporting us!</p>
        <a href="https://www.buymeacoffee.com/moodtask" target="_blank" rel="noopener noreferrer">
            <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me a Coffee" style="width: 150px; height: auto;">
        </a>
    </div>

    <footer>
        <div class="footer-columns">
            <div class="footer-column">
                <h4>MoodTask</h4>
                <p>Transform your mood in seconds with fun, quick activities tailored to how you feel.</p>
            </div>
            <div class="footer-column">
                <h4>Quick Links</h4>
                <a href="index.html" class="footer-link">Home</a>
                <a href="about.html" class="footer-link">About</a>
            </div>
            <div class="footer-column">
                <h4>Legal</h4>
                <a href="privacy.html" class="footer-link">Privacy Policy</a>
                <a href="terms.html" class="footer-link">Terms of Use</a>
            </div>
        </div>
        <p class="disclaimer"><em>General Disclaimer: MoodTask provides this website for informational purposes only. We are not responsible for any errors, omissions, or outcomes resulting from the use of this information. Users follow external links, including those to third-party sites, at their own risk. Always review the terms and privacy policies of external websites.</em></p>
        <p class="copyright">¬© 2025 MoodTask. All rights reserved.</p>
    </footer>

    <div id="breathingPopup" class="popup">
        <div class="popup-content">
            <button class="close-button" onclick="closePopup('breathing')">‚úï</button>
            <h4>Breathing Exercise</h4>
            <p>Follow the circle's rhythm: inhale for 4 seconds, hold for 4, and exhale for 4.</p>
            <div id="breathing-circle">Ready</div>
            <button class="action-button" onclick="startBreathing()">Start</button>
        </div>
    </div>

    <div id="gratitudePopup" class="popup">
        <div class="popup-content">
            <button class="close-button" onclick="closePopup('gratitude')">‚úï</button>
            <h4>Gratitude Note</h4>
            <p>Write down three things you're grateful for today.</p>
            <textarea id="gratitude-text" placeholder="I‚Äôm grateful for..."></textarea>
            <button class="action-button" onclick="saveGratitude()">Save</button>
        </div>
    </div>

    <div id="soundscapePopup" class="popup">
        <div class="popup-content">
            <button class="close-button" onclick="closePopup('soundscape')">‚úï</button>
            <h4>Relaxing Soundscape</h4>
            <p>Choose a sound and relax for 30 seconds.</p>
            <select class="sound-select" id="sound-select">
                <option value="rain">Rain</option>
                <option value="waves">Ocean Waves</option>
                <option value="forest">Forest</option>
            </select>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playSoundscape()"><i class="fas fa-play"></i></button>
                <button class="audio-btn" onclick="pauseSoundscape()"><i class="fas fa-pause"></i></button>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="soundscape-progress"></div>
            </div>
        </div>
    </div>

    <div id="punchingPopup" class="popup">
        <div class="popup-content">
            <button class="close-button" onclick="closePopup('punching')">‚úï</button>
            <h4>Punching Bag</h4>
            <p>Click the bag to release your stress! (10 punches)</p>
            <div id="punching-bag">10</div>
            <p id="punch-counter">Punches left: 10</p>
        </div>
    </div>

    <div id="stretchPopup" class="popup">
        <div class="popup-content">
            <button class="close-button" onclick="closePopup('stretch')">‚úï</button>
            <h4>Quick Stretch</h4>
            <p>Raise your arms up, hold for 5 seconds, then slowly lower them. Repeat 3 times.</p>
            <button class="action-button" onclick="startStretch()">Start</button>
        </div>
    </div>

    <div id="doodlePopup" class="popup">
        <div class="popup-content">
            <button class="close-button" onclick="closePopup('doodle')">‚úï</button>
            <h4>Doodle Pad</h4>
            <p>Draw freely to relax your mind.</p>
            <div class="drawing-tools">
                <input type="color" id="doodle-color" value="#000000">
                <button class="action-button" onclick="clearDoodle()">Clear</button>
            </div>
            <canvas id="doodle-canvas"></canvas>
        </div>
    </div>

    <div id="dancePopup" class="popup">
        <div class="popup-content">
            <button class="close-button" onclick="closePopup('dance')">‚úï</button>
            <h4>Dance Break</h4>
            <p>Play a beat and dance for 15 seconds!</p>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playDanceBeat()"><i class="fas fa-play"></i></button>
                <button class="audio-btn" onclick="pauseDanceBeat()"><i class="fas fa-pause"></i></button>
            </div>
            <div class="progress-container">
                <div class="progress-bar bounce" id="dance-progress"></div>
            </div>
        </div>
    </div>

    <div id="worryPopup" class="popup">
        <div class="popup-content">
            <button class="close-button" onclick="closePopup('worry')">‚úï</button>
            <h4>Worry Shredder</h4>
            <p>Type your worry, then shred it!</p>
            <textarea id="worry-text" placeholder="I‚Äôm worried about..."></textarea>
            <button class="action-button" onclick="shredWorry()">Shred It</button>
            <p id="worry-message"></p>
        </div>
    </div>

    <div id="colorPopup" class="popup">
        <div class="popup-content">
            <button class="close-button" onclick="closePopup('color')">‚úï</button>
            <h4>Color Shift</h4>
            <p>Watch the square change colors to relax your mind.</p>
            <div id="color-square" style="background-color: #2ecc71;"></div>
            <button class="action-button" onclick="startColorShift()">Start</button>
        </div>
    </div>

    <script>
        // Add scroll effect for nav
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('nav');
            if (window.scrollY > 50) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }
        });

        // Scroll to mood prompt
        function scrollToMoodPrompt() {
            document.getElementById('mood-prompt').scrollIntoView({ behavior: 'smooth' });
            gtag('event', 'Get Started Click', { 'event_category': 'Hero', 'event_label': 'Get Started Button' });
        }

        // Existing moodTasks for follow-up questions
        const moodTasks = {
            tired: [
                { emoji: "‚òï", task: "Take 5 deep breaths to re-energize.", followUp: "Feel more awake?" },
                { emoji: "üí°", task: "Stand up and stretch for 30 seconds.", followUp: "Feel more alert?" },
                { emoji: "üé∂", task: "Listen to an upbeat song for a quick boost.", followUp: "Feeling energized?" }
            ],
            stressed: [
                { emoji: "üßò", task: "Try a 1-minute breathing exercise: inhale for 4, hold for 4, exhale for 4.", followUp: "Feel calmer?" },
                { emoji: "‚úçÔ∏è", task: "Write down what‚Äôs stressing you, then take a deep breath.", followUp: "Feel more in control?" },
                { emoji: "üö∂", task: "Take a quick 1-minute walk to clear your mind.", followUp: "Feel more relaxed?" }
            ],
            sad: [
                { emoji: "üíñ", task: "Think of one thing you‚Äôre grateful for today.", followUp: "Feel a bit brighter?" },
                { emoji: "üéµ", task: "Listen to a favorite song that lifts your spirits.", followUp: "Feeling better?" },
                { emoji: "ü§ó", task: "Text a friend or loved one to connect.", followUp: "Feel more supported?" }
            ],
            anxious: [
                { emoji: "üå≥", task: "Focus on 5 things you can see around you to ground yourself.", followUp: "Feel more present?" },
                { emoji: "üñêÔ∏è", task: "Place your hand on your heart and take 5 slow breaths.", followUp: "Feel calmer?" },
                { emoji: "üìù", task: "Write down your worry, then let it go for now.", followUp: "Feel less anxious?" }
            ],
            angry: [
                { emoji: "üëä", task: "Clench your fists, then release while exhaling slowly.", followUp: "Feel less tense?" },
                { emoji: "üì£", task: "Find a private space and let out a loud sigh or hum.", followUp: "Feel more released?" },
                { emoji: "üí®", task: "Take 5 deep breaths, exhaling longer than you inhale.", followUp: "Feel calmer?" }
            ],
            bored: [
                { emoji: "üé®", task: "Doodle on a piece of paper for 1 minute.", followUp: "Feel more engaged?" },
                { emoji: "üï∫", task: "Put on a song and dance for 30 seconds.", followUp: "Feeling more entertained?" },
                { emoji: "üí≠", task: "Think of a fun activity you‚Äôd like to do later today.", followUp: "Feel more inspired?" }
            ],
            happy: [
                { emoji: "üòÑ", task: "Share your happiness‚Äîtext a friend something positive!", followUp: "Feel even better?" },
                { emoji: "üéâ", task: "Celebrate with a quick dance or stretch.", followUp: "Still smiling?" },
                { emoji: "üì∏", task: "Take a moment to appreciate this feeling and smile.", followUp: "Feel the joy?" }
            ],
            lonely: [
                { emoji: "üìû", task: "Call or message a friend or family member.", followUp: "Feel more connected?" },
                { emoji: "üíå", task: "Write a kind note to yourself about your strengths.", followUp: "Feel more supported?" },
                { emoji: "üêæ", task: "If you have a pet, give them some love.", followUp: "Feel less alone?" }
            ]
        };

        // Enhanced mood-to-tool mapping with effectiveness ratings (1-5) [Claude's Code]
        const moodTools = {
            tired: [
                { tool: 'breathing', effectiveness: 4, reason: "Deep breathing increases oxygen to your brain and muscles" },
                { tool: 'stretch', effectiveness: 5, reason: "Physical movement stimulates blood flow and energy" },
                { tool: 'dance', effectiveness: 4, reason: "Gets your body moving and releases endorphins" },
                { tool: 'color', effectiveness: 3, reason: "Visual stimulation can increase alertness" }
            ],
            stressed: [
                { tool: 'breathing', effectiveness: 5, reason: "Activates parasympathetic nervous system to reduce stress" },
                { tool: 'punching', effectiveness: 4, reason: "Physical release of tension" },
                { tool: 'soundscape', effectiveness: 4, reason: "Auditory distraction and calming effect" },
                { tool: 'worry', effectiveness: 3, reason: "Helps process and release concerns" }
            ],
            sad: [
                { tool: 'gratitude', effectiveness: 5, reason: "Shifts focus to positive aspects in your life" },
                { tool: 'dance', effectiveness: 4, reason: "Movement and music boost mood-enhancing hormones" },
                { tool: 'color', effectiveness: 3, reason: "Color therapy can influence emotional state" },
                { tool: 'doodle', effectiveness: 3, reason: "Creative expression helps process emotions" }
            ],
            anxious: [
                { tool: 'breathing', effectiveness: 5, reason: "Slows heart rate and induces relaxation" },
                { tool: 'worry', effectiveness: 4, reason: "Externalizes and processes anxious thoughts" },
                { tool: 'soundscape', effectiveness: 4, reason: "Provides grounding sensory input" },
                { tool: 'doodle', effectiveness: 3, reason: "Mindful activity redirects anxious energy" }
            ],
            angry: [
                { tool: 'punching', effectiveness: 5, reason: "Safe physical outlet for anger" },
                { tool: 'breathing', effectiveness: 4, reason: "Calms physiological anger response" },
                { tool: 'worry', effectiveness: 3, reason: "Helps process and understand angry feelings" },
                { tool: 'stretch', effectiveness: 3, reason: "Releases physical tension stored in muscles" }
            ],
            bored: [
                { tool: 'dance', effectiveness: 5, reason: "Provides immediate stimulation and fun" },
                { tool: 'doodle', effectiveness: 4, reason: "Creative engagement activates mind" },
                { tool: 'color', effectiveness: 4, reason: "Visual engagement and focus" },
                { tool: 'stretch', effectiveness: 3, reason: "Physical activity shifts energy" }
            ],
            happy: [
                { tool: 'dance', effectiveness: 5, reason: "Amplifies positive feelings through movement" },
                { tool: 'gratitude', effectiveness: 5, reason: "Reinforces and extends positive emotions" },
                { tool: 'doodle', effectiveness: 3, reason: "Channel creative energy in a positive state" },
                { tool: 'color', effectiveness: 3, reason: "Extends the positive sensory experience" }
            ],
            lonely: [
                { tool: 'gratitude', effectiveness: 4, reason: "Fosters connection with positive aspects of life" },
                { tool: 'soundscape', effectiveness: 4, reason: "Creates ambient presence and comfort" },
                { tool: 'dance', effectiveness: 3, reason: "Self-expression and connection with music" },
                { tool: 'doodle', effectiveness: 3, reason: "Self-expression and creative connection" }
            ]
        };

        // User mood and activity tracking [Claude's Code]
        let userPreferences = {
            lastMood: null,
            activityHistory: [],
            favorites: [],
            achievements: {
                moodVariety: 0,
                activityCompletions: 0,
                streakDays: 0
            }
        };

        // Load user data from localStorage [Claude's Code]
        function loadUserData() {
            const savedData = localStorage.getItem('moodTaskUserData');
            if (savedData) {
                userPreferences = JSON.parse(savedData);
                
                // Update UI based on saved data
                if (userPreferences.lastMood) {
                    const moodButton = document.querySelector(`button[data-mood="${userPreferences.lastMood}"]`);
                    if (moodButton) moodButton.classList.add('last-selected');
                }
                
                updateAchievementDisplay();
            }

            // Check for streak
            const lastVisit = localStorage.getItem('moodTaskLastVisit');
            const today = new Date().toDateString();
            
            if (lastVisit) {
                const lastDate = new Date(lastVisit);
                const dayDifference = Math.floor((new Date(today) - lastDate) / (1000 * 60 * 60 * 24));
                
                if (dayDifference === 1) {
                    userPreferences.achievements.streakDays++;
                    showStreakNotification(userPreferences.achievements.streakDays);
                } else if (dayDifference > 1) {
                    userPreferences.achievements.streakDays = 1;
                }
            }
            
            localStorage.setItem('moodTaskLastVisit', today);
            saveUserData();
        }

        // Save user data to localStorage [Claude's Code]
        function saveUserData() {
            localStorage.setItem('moodTaskUserData', JSON.stringify(userPreferences));
        }

        // Show streak notification [Claude's Code]
        function showStreakNotification(days) {
            const notification = document.createElement('div');
            notification.className = 'streak-notification';
            notification.innerHTML = `
                <div class="streak-icon">üî•</div>
                <div class="streak-text">
                    <h4>${days} Day Streak!</h4>
                    <p>You're making mood improvement a habit</p>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 500);
            }, 5000);
        }

        // Display achievement progress [Claude's Code]
        function updateAchievementDisplay() {
            // Create or update achievement section
            let achievementSection = document.getElementById('achievements');
            
            if (!achievementSection) {
                achievementSection = document.createElement('div');
                achievementSection.id = 'achievements';
                achievementSection.className = 'achievement-section';
                achievementSection.innerHTML = `
                    <h3>Your Progress</h3>
                    <div class="achievement-grid"></div>
                `;
                document.getElementById('result').after(achievementSection);
            }
            
            const achievementGrid = achievementSection.querySelector('.achievement-grid');
            achievementGrid.innerHTML = `
                <div class="achievement-card">
                    <div class="achievement-icon">üîç</div>
                    <div class="achievement-info">
                        <h4>Mood Explorer</h4>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${Math.min(userPreferences.achievements.moodVariety/8*100, 100)}%"></div>
                        </div>
                        <p>${userPreferences.achievements.moodVariety}/8 different moods explored</p>
                    </div>
                </div>
                <div class="achievement-card">
                    <div class="achievement-icon">üèÜ</div>
                    <div class="achievement-info">
                        <h4>Activity Master</h4>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${Math.min(userPreferences.achievements.activityCompletions/20*100, 100)}%"></div>
                        </div>
                        <p>${userPreferences.achievements.activityCompletions}/20 activities completed</p>
                    </div>
                </div>
                <div class="achievement-card">
                    <div class="achievement-icon">üî•</div>
                    <div class="achievement-info">
                        <h4>Consistency Streak</h4>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${Math.min(userPreferences.achievements.streakDays/7*100, 100)}%"></div>
                        </div>
                        <p>${userPreferences.achievements.streakDays} day streak</p>
                    </div>
                </div>
            `;
        }

        // Enhanced mood selection [Claude's Code]
        document.querySelectorAll('#mood-buttons button').forEach(button => {
            button.addEventListener('click', () => {
                // Visual feedback for selection
                document.querySelectorAll('#mood-buttons button').forEach(btn => btn.classList.remove('selected'));
                button.classList.add('selected');
                
                // Get the selected mood
                const mood = button.getAttribute('data-mood');
                
                // Track this mood selection
                userPreferences.lastMood = mood;
                
                // Update achievement if this is a new mood
                const uniqueMoods = new Set([...userPreferences.activityHistory.map(item => item.mood), mood]);
                userPreferences.achievements.moodVariety = uniqueMoods.size;
                
                saveUserData();
                
                // Show task for this mood
                showTask(mood);
                
                // Highlight recommended tools
                highlightRecommendedTools(mood);
                
                gtag('event', 'Mood Selection', { 'event_category': 'Mood', 'event_label': mood });
            });
        });

        // Highlight recommended tools based on selected mood [Claude's Code]
        function highlightRecommendedTools(mood) {
            // Reset all tool highlights
            document.querySelectorAll('.tool-button').forEach(tool => {
                tool.classList.remove('highly-recommended', 'recommended', 'somewhat-recommended');
                tool.querySelector('.effectiveness-badge')?.remove();
            });
            
            // If no mood is selected, return
            if (!mood) return;
            
            // Get recommended tools for this mood
            const recommendations = moodTools[mood];
            
            // Apply highlights based on effectiveness
            recommendations.forEach(rec => {
                const toolButton = document.querySelector(`.tool-button.${rec.tool}`);
                if (!toolButton) return;
                
                // Add effectiveness class
                if (rec.effectiveness >= 5) {
                    toolButton.classList.add('highly-recommended');
                } else if (rec.effectiveness >= 4) {
                    toolButton.classList.add('recommended');
                } else {
                    toolButton.classList.add('somewhat-recommended');
                }
                
                // Add effectiveness badge
                const badge = document.createElement('div');
                badge.className = 'effectiveness-badge';
                badge.innerHTML = `${rec.effectiveness}/5`;
                
                // Add tooltip with reason
                toolButton.setAttribute('data-reason', rec.reason);
                
                // Append badge to tool button
                toolButton.appendChild(badge);
            });
            
            // Add pulse animation to top recommendation
            const topRecommendation = recommendations.sort((a, b) => b.effectiveness - a.effectiveness)[0];
            if (topRecommendation) {
                const topToolButton = document.querySelector(`.tool-button.${topRecommendation.tool}`);
                if (topToolButton) {
                    topToolButton.classList.add('pulse-animation');
                    
                    // Add "Try this!" flag to top recommendation
                    const tryThisFlag = document.createElement('div');
                    tryThisFlag.className = 'try-this-flag';
                    tryThisFlag.textContent = 'Try this!';
                    topToolButton.appendChild(tryThisFlag);
                }
            }
        }

        // Enhanced task display [Claude's Code, modified to include followUp]
        function showTask(mood) {
            const tasks = moodTasks[mood];
            const randomTask = tasks[Math.floor(Math.random() * tasks.length)];
            const recommendations = moodTools[mood];
            const topRecommendation = recommendations.sort((a, b) => b.effectiveness - a.effectiveness)[0];
            const resultDiv = document.getElementById('result');
            
            // Create animated entry for the task
            resultDiv.innerHTML = `
                <div class="chat-bubble animated-entry">
                    <div class="task-header">
                        <span class="mood-emoji">${randomTask.emoji}</span>
                        <h3>Task for ${mood.charAt(0).toUpperCase() + mood.slice(1)}</h3>
                    </div>
                    <p class="task-text">Try the <strong>${topRecommendation.tool.replace('-', ' ')}</strong> tool - ${topRecommendation.reason}.</p>
                    <div class="timer-container" id="taskTimer">
                        <button class="timer-button" onclick="startTaskTimer(30)">
                            <i class="fas fa-stopwatch"></i> Start 30s Timer
                        </button>
                        <div class="timer-progress">
                            <div class="timer-bar"></div>
                        </div>
                        <span class="timer-text"></span>
                    </div>
                    <p class="follow-up-question">${randomTask.followUp}</p>
                    <div class="reaction-buttons">
                        <button class="reaction-button" onclick="recordReaction('${mood}', '${topRecommendation.tool}', 'didnt-help')">
                            <span class="reaction-icon">üëé</span> Didn't help
                        </button>
                        <button class="reaction-button" onclick="recordReaction('${mood}', '${topRecommendation.tool}', 'somewhat-helped')">
                            <span class="reaction-icon">üëå</span> Somewhat helped
                        </button>
                        <button class="reaction-button" onclick="recordReaction('${mood}', '${topRecommendation.tool}', 'really-helped')">
                            <span class="reaction-icon">üëç</span> Really helped!
                        </button>
                    </div>
                    <div class="task-buttons">
                        <button class="favorite-button" onclick="saveFavorite('${mood}', '${topRecommendation.tool}')">
                            <span class="heart-icon">‚ù§Ô∏è</span> Favorite
                        </button>
                        <button class="new-task-button" onclick="showTask('${mood}')">New Task</button>
                    </div>
                </div>
            `;
            
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Task timer functionality [Claude's Code]
        function startTaskTimer(seconds) {
            const timerContainer = document.getElementById('taskTimer');
            const timerButton = timerContainer.querySelector('.timer-button');
            const timerBar = timerContainer.querySelector('.timer-bar');
            const timerText = timerContainer.querySelector('.timer-text');
            
            timerButton.style.display = 'none';
            timerBar.style.display = 'block';
            timerText.style.display = 'block';
            
            let timeLeft = seconds;
            timerText.textContent = `${timeLeft}s`;
            timerBar.style.width = '100%';
            
            const interval = setInterval(() => {
                timeLeft--;
                timerText.textContent = `${timeLeft}s`;
                timerBar.style.width = `${(timeLeft/seconds)*100}%`;
                
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    timerText.textContent = 'Complete!';
                    // Confetti effect when timer completes
                    showCompletionConfetti();
                    
                    // Record completion for achievements
                    userPreferences.achievements.activityCompletions++;
                    saveUserData();
                    updateAchievementDisplay();
                }
            }, 1000);
        }

        // Confetti effect for task completion [Claude's Code]
        function showCompletionConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-container';
            document.body.appendChild(confettiContainer);
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.setProperty('--fall-duration', `${Math.random() * 3 + 2}s`);
                confetti.style.setProperty('--fall-delay', `${Math.random() * 2}s`);
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 80%, 60%)`;
                confettiContainer.appendChild(confetti);
            }
            
            setTimeout(() => {
                confettiContainer.remove();
            }, 5000);
        }

        // Record user's reaction to the task [Claude's Code]
        function recordReaction(mood, task, reaction) {
            // Store this reaction
            userPreferences.activityHistory.push({
                mood: mood,
                task: task,
                reaction: reaction,
                timestamp: new Date().toISOString()
            });
            
            saveUserData();
            
            // Show feedback based on reaction
            const reactionButtons = document.querySelector('.reaction-buttons');
            
            reactionButtons.innerHTML = '<p class="reaction-feedback">Thanks for your feedback!</p>';
            
            // If it didn't help, suggest trying a tool
            if (reaction === 'didnt-help') {
                const recommendations = moodTools[mood];
                const topRecommendation = recommendations.sort((a, b) => b.effectiveness - a.effectiveness)[0];
                
                if (topRecommendation) {
                    reactionButtons.innerHTML += `
                        <p class="tool-suggestion">
                            Try the <strong>${topRecommendation.tool.replace('-', ' ')}</strong> tool - 
                            ${topRecommendation.reason}.
                            <button class="try-tool-button" onclick="openPopup('${topRecommendation.tool}')">
                                Try Now
                            </button>
                        </p>
                    `;
                }
            }
            
            gtag('event', 'Task Reaction', { 
                'event_category': 'Task', 
                'event_label': `${mood} - ${reaction}` 
            });
        }

        // Enhanced Save favorite task (localStorage implementation) [Claude's Code]
        function saveFavorite(mood, task) {
            // Add to favorites if not already there
            if (!userPreferences.favorites.some(fav => fav.mood === mood && fav.task === task)) {
                userPreferences.favorites.push({
                    mood: mood,
                    task: task,
                    timestamp: new Date().toISOString()
                });
                
                saveUserData();
                
                // Show saved confirmation with heart animation
                const favoriteButton = document.querySelector('.favorite-button');
                favoriteButton.innerHTML = '<span class="heart-icon animated-heart">‚ù§Ô∏è</span> Saved!';
                favoriteButton.disabled = true;
            }
            
            gtag('event', 'Favorite Task', { 'event_category': 'Task', 'event_label': `${mood} - ${task}` });
        }

        // Enhanced tool popup opening with animation and tracking [Claude's Code]
        function openPopup(tool) {
            const popup = document.getElementById(`${tool}Popup`);
            
            // Create animated entrance
            popup.style.display = 'flex';
            popup.classList.add('popup-entering');
            
            setTimeout(() => {
                popup.classList.remove('popup-entering');
            }, 300);
            
            // Initialize specific tool
            if (tool === 'doodle') initDoodle();
            if (tool === 'breathing') prepareBreathingCircle();
            if (tool === 'color') prepareColorShift();
            if (tool === 'punching') preparePunchingBag();
            
            // Track tool usage
            userPreferences.activityHistory.push({
                type: 'tool',
                tool: tool,
                timestamp: new Date().toISOString()
            });
            
            saveUserData();
            
            gtag('event', 'Tool Opened', { 'event_category': 'Tool', 'event_label': tool });
        }

        // Close popup [Existing Code]
        function closePopup(tool) {
            document.getElementById(`${tool}Popup`).style.display = 'none';
            if (tool === 'soundscape') pauseSoundscape();
            if (tool === 'dance') pauseDanceBeat();
        }

        // Enhanced breathing exercise with animated circle and guided instructions [Claude's Code]
        function prepareBreathingCircle() {
            const circle = document.getElementById('breathing-circle');
            const instructions = document.createElement('div');
            instructions.className = 'breathing-instructions';
            instructions.textContent = 'Click Start when ready';
            
            // Reset the circle to initial state
            circle.className = '';
            circle.textContent = 'Ready';
            
            // If there's already an instruction div, remove it
            const existingInstructions = document.querySelector('.breathing-instructions');
            if (existingInstructions) existingInstructions.remove();
            
            circle.after(instructions);
        }

        // Enhanced breathing exercise with better visuals [Claude's Code]
        function startBreathing() {
            const circle = document.getElementById('breathing-circle');
            const instructions = document.querySelector('.breathing-instructions');
            const startButton = document.querySelector('#breathingPopup .action-button');
            
            startButton.disabled = true;
            
            // Set up cycle steps with animations and timing
            const steps = [
                { phase: 'Inhale', duration: 4000, animation: 'expand', instruction: 'Breathe in slowly...' },
                { phase: 'Hold', duration: 4000, animation: 'hold', instruction: 'Hold your breath...' },
                { phase: 'Exhale', duration: 4000, animation: 'contract', instruction: 'Release slowly...' },
                { phase: 'Rest', duration: 2000, animation: 'rest', instruction: 'And relax...' }
            ];
            
            let currentStep = 0;
            let cycleCount = 0;
            const totalCycles = 3;
            
            // Update function for breathing cycle
            function updateBreathingState() {
                const step = steps[currentStep];
                
                // Update UI for this step
                circle.className = step.animation;
                circle.textContent = step.phase;
                instructions.textContent = step.instruction;
                
                // Prepare for next step
                currentStep = (currentStep + 1) % steps.length;
                
                // If completed a full cycle
                if (currentStep === 0) {
                    cycleCount++;
                    
                    // If all cycles completed
                    if (cycleCount >= totalCycles) {
                        setTimeout(() => {
                            circle.className = 'complete';
                            circle.textContent = 'Complete';
                            instructions.textContent = 'Great job!';
                            startButton.disabled = false;
                            startButton.textContent = 'Restart';
                            
                            // Show completion particles
                            showBreathingCompletionEffect();
                        }, steps[3].duration);
                        return;
                    }
                }
                
                // Schedule next update
                setTimeout(updateBreathingState, step.duration);
            }
            
            // Start the first step
            updateBreathingState();
        }

        // Breathing completion effect [Claude's Code]
        function showBreathingCompletionEffect() {
            const container = document.querySelector('#breathingPopup .popup-content');
            
            // Create particles
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'breathing-particle';
                
                // Random position around the circle
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 50;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                
                // Set particle style
                particle.style.left = `calc(50% + ${x}px)`;
                particle.style.top = `calc(50% + ${y}px)`;
                particle.style.backgroundColor = `hsl(${120 + Math.random() * 60}, 80%, 60%)`;
                particle.style.animationDelay = `${Math.random() * 0.5}s`;
                
                container.appendChild(particle);
                
                // Remove particle after animation completes
                setTimeout(() => {
                    particle.remove();
                }, 2000);
            }
        }

        // Enhanced color shift animation [Claude's Code]
        function prepareColorShift() {
            const square = document.getElementById('color-square');
            
            // Reset square to initial state
            square.style.backgroundColor = '#2ecc71';
            square.style.transform = 'scale(1)';
            square.innerHTML = '';
        }

        // Enhanced color shift with pulsing and mood recommendations [Claude's Code]
        function startColorShift() {
            const square = document.getElementById('color-square');
            const colors = [
                { color: '#2ecc71', mood: 'tranquil', transform: 'scale(1)' },
                { color: '#3498db', mood: 'calm', transform: 'scale(1.1) rotate(5deg)' },
                { color: '#9b59b6', mood: 'creative', transform: 'scale(0.9) rotate(-5deg)' },
                { color: '#e74c3c', mood: 'energized', transform: 'scale(1.2)' },
                { color: '#f1c40f', mood: 'optimistic', transform: 'scale(1) rotate(10deg)' }
            ];
            
            let index = 0;
            
            // Update the button state
            const button = document.querySelector('#colorPopup .action-button');
            button.disabled = true;
            button.textContent = 'Shifting...';
            
            // Create mood label inside square
            const moodLabel = document.createElement('div');
            moodLabel.className = 'color-mood-label';
            square.appendChild(moodLabel);
            
            // Start color shifting animation
            const interval = setInterval(() => {
                const colorInfo = colors[index];
                
                // Apply color and transform
                square.style.backgroundColor = colorInfo.color;
                square.style.transform = colorInfo.transform;
                
                // Update mood label with fade effect
                moodLabel.style.opacity = '0';
                setTimeout(() => {
                    moodLabel.textContent = colorInfo.mood;
                    moodLabel.style.opacity = '1';
                }, 300);
                
                // Move to next color
                index = (index + 1) % colors.length;
            }, 2000);
            
            // End the animation after 10 seconds
            setTimeout(() => {
                clearInterval(interval);
                square.style.transform = 'scale(1)';
                
                // Update mood label to completion
                moodLabel.style.opacity = '0';
                setTimeout(() => {
                    moodLabel.textContent = 'Complete';
                    moodLabel.style.opacity = '1';
                }, 300);
                
                // Reset button
                button.disabled = false;
                button.textContent = 'Start Again';
            }, 10000);
        }

        // Enhanced punching bag with better effects [Claude's Code]
        let punchCount = 10;
        function preparePunchingBag() {
            // Reset punch count
            punchCount = 10;
            
            const bag = document.getElementById('punching-bag');
            const counter = document.getElementById('punch-counter');
            
            bag.textContent = punchCount;
            counter.textContent = `Punches left: ${punchCount}`;
            
            // Add shadow effect to bag
            bag.style.boxShadow = '0 10px 20px rgba(0,0,0,0.3)';
        }

        // Punching bag interaction [Existing Code]
        document.getElementById('punching-bag').addEventListener('click', () => {
            if (punchCount > 0) {
                punchCount--;
                const bag = document.getElementById('punching-bag');
                bag.style.transform = 'rotate(5deg)';
                setTimeout(() => bag.style.transform = 'rotate(-5deg)', 100);
                setTimeout(() => bag.style.transform = 'rotate(0deg)', 200);
                bag.textContent = punchCount;
                document.getElementById('punch-counter').textContent = `Punches left: ${punchCount}`;
                if (punchCount === 0) {
                    setTimeout(() => {
                        bag.textContent = 'Done!';
                        document.getElementById('punch-counter').textContent = 'Great job!';
                    }, 300);
                }
            }
        });

        // Gratitude note [Existing Code]
        function saveGratitude() {
            const text = document.getElementById('gratitude-text').value;
            if (text.trim()) {
                alert('Gratitude note saved! (This will be stored locally in the future)');
                document.getElementById('gratitude-text').value = '';
                closePopup('gratitude');
            } else {
                alert('Please write something before saving.');
            }
        }

        // Soundscape [Existing Code]
        let soundscapeAudio = null;
        let soundscapeInterval = null;

        function playSoundscape() {
            const select = document.getElementById('sound-select');
            const sound = select.value;
            if (soundscapeAudio) {
                soundscapeAudio.pause();
                soundscapeAudio = null;
            }

            // Create audio object and set the source
            soundscapeAudio = new Audio(`sounds/${sound}.mp3`);
            soundscapeAudio.loop = false;

            // Add error handling for audio loading
            soundscapeAudio.onerror = () => {
                console.error(`Failed to load audio file: sounds/${sound}.mp3`);
                alert(`Sorry, the sound file for "${sound}" could not be loaded. Please ensure the file exists in the sounds/ directory.`);
            };

            // Play the audio and handle playback errors
            soundscapeAudio.play().catch(error => {
                console.error('Audio playback failed:', error);
                alert('Audio playback failed. Please ensure your browser allows audio playback and the file is accessible.');
            });

            // Update progress bar
            const progressBar = document.getElementById('soundscape-progress');
            progressBar.style.width = '100%';
            let timeLeft = 30;
            soundscapeInterval = setInterval(() => {
                timeLeft--;
                progressBar.style.width = (timeLeft / 30 * 100) + '%';
                if (timeLeft <= 0) {
                    clearInterval(soundscapeInterval);
                    soundscapeAudio.pause();
                    soundscapeAudio = null;
                }
            }, 1000);
        }

        function pauseSoundscape() {
            if (soundscapeAudio) {
                soundscapeAudio.pause();
                soundscapeAudio = null;
            }
            if (soundscapeInterval) {
                clearInterval(soundscapeInterval);
            }
            document.getElementById('soundscape-progress').style.width = '100%';
        }

        // Stretch [Existing Code]
        function startStretch() {
            alert('Follow the instructions: Raise your arms, hold for 5 seconds, and lower them. Repeat 3 times.');
            closePopup('stretch');
        }

        // Doodle pad [Existing Code]
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        function initDoodle() {
            const canvas = document.getElementById('doodle-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            canvas.addEventListener('mousedown', (e) => {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
            });

            canvas.addEventListener('mousemove', (e) => {
                if (isDrawing) {
                    ctx.beginPath();
                    ctx.moveTo(lastX, lastY);
                    ctx.lineTo(e.offsetX, e.offsetY);
                    ctx.strokeStyle = document.getElementById('doodle-color').value;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    [lastX, lastY] = [e.offsetX, e.offsetY];
                }
            });

            canvas.addEventListener('mouseup', () => isDrawing = false);
            canvas.addEventListener('mouseout', () => isDrawing = false);
        }

        function clearDoodle() {
            const canvas = document.getElementById('doodle-canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Dance break [Existing Code]
        let danceAudio = null;
        let danceInterval = null;

        function playDanceBeat() {
            if (danceAudio) danceAudio.pause();
            danceAudio = new Audio('sounds/dance-beat.mp3');
            danceAudio.loop = false;
            danceAudio.play();

            const progressBar = document.getElementById('dance-progress');
            progressBar.className = 'progress-bar bounce';
            let timeLeft = 15;
            danceInterval = setInterval(() => {
                timeLeft--;
                progressBar.style.width = (timeLeft / 15 * 100) + '%';
                if (timeLeft <= 0) {
                    clearInterval(danceInterval);
                    danceAudio.pause();
                }
            }, 1000);
        }

        function pauseDanceBeat() {
            if (danceAudio) danceAudio.pause();
            if (danceInterval) clearInterval(danceInterval);
            document.getElementById('dance-progress').style.width = '100%';
        }

        // Worry shredder [Existing Code]
        function shredWorry() {
            const worryText = document.getElementById('worry-text');
            const worryMessage = document.getElementById('worry-message');
            if (worryText.value.trim()) {
                worryText.classList.add('shredding');
                worryMessage.textContent = 'Shredding your worry...';
                setTimeout(() => {
                    worryText.value = '';
                    worryMessage.textContent = 'Worry shredded!';
                    worryText.classList.remove('shredding');
                }, 1000);
            } else {
                worryMessage.textContent = 'Please write a worry to shred.';
            }
        }

        // Share on X [Existing Code]
        document.getElementById('share').addEventListener('click', () => {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('Boost your mood with MoodTask! Select your mood and get a quick, science-backed task to feel better. #MoodBoost');
            window.open(`https://x.com/intent/tweet?url=${url}&text=${text}`, '_blank');
            gtag('event', 'Share', { 'event_category': 'Social', 'event_label': 'X Share' });
        });

        // Initialize when page loads [Claude's Code]
        document.addEventListener('DOMContentLoaded', () => {
            loadUserData();
            
            // Add personal greeting based on time of day
            const greeting = document.getElementById('instruction');
            const hour = new Date().getHours();
            let timeBasedGreeting = '';
            
            if (hour < 12) {
                timeBasedGreeting = 'Good Morning! ';
            } else if (hour < 18) {
                timeBasedGreeting = 'Good Afternoon! ';
            } else {
                timeBasedGreeting = 'Good Evening! ';
            }
            
            greeting.textContent = timeBasedGreeting + 'How Are You Feeling Right Now?';
            
            // If user has a previous mood, highlight recommended tools
            if (userPreferences.lastMood) {
                highlightRecommendedTools(userPreferences.lastMood);

                        // Initialize when page loads [Claude's Code]
        document.addEventListener('DOMContentLoaded', () => {
            loadUserData();
            
            // Add personal greeting based on time of day
            const greeting = document.getElementById('instruction');
            const hour = new Date().getHours();
            let timeBasedGreeting = '';
            
            if (hour < 12) {
                timeBasedGreeting = 'Good Morning! ';
            } else if (hour < 18) {
                timeBasedGreeting = 'Good Afternoon! ';
            } else {
                timeBasedGreeting = 'Good Evening! ';
            }
            
            greeting.textContent = timeBasedGreeting + 'How Are You Feeling Right Now?';
            
            // If user has a previous mood, highlight recommended tools
            if (userPreferences.lastMood) {
                highlightRecommendedTools(userPreferences.lastMood);
            }
            
            // Preload sounds
            const sounds = ['rain', 'waves', 'forest', 'dance-beat'];
            sounds.forEach(sound => {
                const audio = new Audio();
                audio.preload = 'auto';
                audio.src = `sounds/${sound}.mp3`;
            });
        });
    </script>
</body>
</html>
            }
            
            // Preload sounds
            const sounds = ['rain', 'waves', 'forest', 'dance
